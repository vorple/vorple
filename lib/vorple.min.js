Function.prototype.inherits=function(d){var a={},c=this.prototype=new d;this.prototype.uber=function(b){b in a||(a[b]=0);var e,f;e=a[b];f=d.prototype;if(e){for(;e;)f=f.constructor.prototype,e-=1;e=f[b]}else e=c[b],e==this[b]&&(e=f[b]);a[b]+=1;f=e.apply(this,Array.prototype.slice.apply(arguments,[1]));a[b]-=1;return f};return this};var vorple={};
(function(d){vorple.core={release:2,version:1,system:null};vorple.core.defaults={target:"_blank"};vorple.core.settings={confirmWindowClose:!1,debug:!1};vorple.core._init=function(a){this.system=a;d(".vorple-version").html(this.version+"."+this.release);window.onbeforeunload=function(a){if(vorple.core.settings.confirmWindowClose&&!vorple.core.settings.debug){var b;b=!0===vorple.core.settings.confirmWindowClose?"You are about to leave the story. Any unsaved progress will be lost. Are you sure you want to continue?":
vorple.core.settings.confirmWindowClose;a&&(a.returnValue=b);return b}};"undefined"===typeof window.console&&(window.console={log:function(){}})};vorple.core.engine=function(a){return"string"===typeof a?"undum"==a?"undefined"!==typeof undum:!1:"undefined"!==typeof undum?"undum":null};vorple.core.generateId=function(a){void 0===a&&(a=32);for(var c="",b=0;b<a;++b)var d=0==b?Math.floor(52*Math.random())+10:Math.floor(62*Math.random()),c=10>d?c+(""+d):36>d?c+String.fromCharCode(d+55):c+String.fromCharCode(d+
61);return c};vorple.core.init=function(a){this._init(a);d(document).trigger("vorpleInit")};vorple.core.clickLink=function(a,c){d.extend({},this.defaults,c);this.engine("undum")?this.system.doClick(a):window.location=a};vorple.core.requireRelease=function(a,c){var b,e=!1,f;d.isArray(a)?(b=a[0],e=a[1],f=b+"-"+e):f=b=a;if(b>this.release||!1!==e&&e<this.release)switch(typeof c){case "function":c();break;case "string":throw Error(c);default:throw Error("Version mismatch: release "+f+" required, currently running release "+
this.release);}return!0}})(jQuery);(function(d){vorple.button={};vorple.button.defaults={groupParent:"<div>"};vorple.button.template=function(){this.defaults={classes:""}};vorple.button.template.prototype.init=function(a,c,b){this.opt="object"===typeof b?d.extend({},this.defaults,b):"object"===typeof c?d.extend({},this.defaults,c):d.extend({},this.defaults);this.content="undefined"!==typeof a?a:"";this.idClass="button_"+vorple.core.generateId();this.opt.classes+=" vorpleButton basicButton "+this.idClass;this.options=b;this.element=
this.createElement(a,this.opt);this.onclick="function"===d.type(c)?c:"string"===d.type(c)?function(a){vorple.core.clickLink(c);a.preventDefault()}:d.noop;this.createClickEvent(this.onclick)};vorple.button.template.prototype.createClickEvent=function(a){var c=this;d(document).on("click","."+this.idClass,function(b){c.isEnabled()&&a(b)})};vorple.button.template.prototype.createElement=function(a){return a};vorple.button.template.prototype.disable=d.noop;vorple.button.template.prototype.enable=d.noop;
vorple.button.template.prototype.isEnabled=d.noop;vorple.button.template.prototype.html=function(){return this.element};vorple.button.Button=function(a,c,b){this.init(a,c,b)};vorple.button.Button.inherits(vorple.button.template);vorple.button.Button.prototype.createElement=function(a,c){return vorple.html.tag("button",a,c)};vorple.button.Button.prototype.disable=function(){d("."+this.idClass).prop("disabled",!0)};vorple.button.Button.prototype.enable=function(){d("."+this.idClass).prop("disabled",
!1)};vorple.button.Button.prototype.isEnabled=function(){return!d("."+this.idClass).prop("disabled")};vorple.button.Link=function(a,c,b){this.defaults={classes:"",href:"#"};this.init(a,c,b)};vorple.button.Link.inherits(vorple.button.template);vorple.button.Link.prototype.createElement=function(a,c){return this.tag=vorple.html.link(c.href,a,c)};vorple.button.Link.prototype.disable=function(){d("."+this.idClass).replaceWith('<span class="ex_link '+this.opt.classes+'">'+this.content+"</span>")};vorple.button.Link.prototype.enable=
function(){d("."+this.idClass).replaceWith(this.tag)};vorple.button.Link.prototype.isEnabled=function(){return!d("."+this.idClass).hasClass("ex_link")};vorple.button.Image=function(a,c,b){this.enabled=!0;this.init(a,c,b)};vorple.button.Image.inherits(vorple.button.template);vorple.button.Image.prototype.createElement=function(a,c){var b=vorple.media.image(a,c);this.url=d(b).attr("src");return b};vorple.button.Image.prototype.disable=function(){this.enabled=!1;"disabledImage"in this.opt&&d("."+this.idClass).attr("src",
this.opt.disabledImage)};vorple.button.Image.prototype.enable=function(){this.enabled=!0;d("."+this.idClass).attr("src",this.url)};vorple.button.Image.prototype.isEnabled=function(){return this.enabled};vorple.button.Group=function(a,c){function b(a){"string"===typeof a||"object"===typeof a&&"undefined"!==typeof a.jquery?e.append(a):a&&e.append(a.html())}var e,f=[];"object"===d.type(c)||"undefined"===typeof c||!c?"object"===d.type(c)&&"undefined"!==typeof c.jquery?e=c:("object"!==d.type(c)?c={tag:"div"}:
"undefined"===typeof c.tag&&(c.tag="div"),e=d(vorple.html.tag(c.tag,null,c,{endTag:"never"}))):e="string"===d.type(c)?d(c):d(vorple.button.defaults.groupParent);"array"===d.type(a)?f=a:"undefined"!==typeof a&&a&&f.push(a);d.each(f,function(a,c){b(c)});this.add=function(a){d.each("array"!==typeof a?[a]:a,function(a,c){var e=!1;"object"===typeof c&&"idClass"in c&&d.each(f,function(a,b){"object"===typeof b&&"idClass"in b&&c.idClass==b.idClass&&(e=!0)});e||(f.push(c),b(c))})};this.contains=function(a){return-1<
d.inArray(a,f)};this.enable=function(){d.each(f,function(a,b){d.isFunction(b.enable)&&b.enable()})};this.disable=function(){d.each(f,function(a,b){d.isFunction(b.disable)&&b.disable()})};this.html=function(){return vorple.html.$toHtml(e)};this.update=function(a,c){var h=[];c?(d.each(f,function(b,c){"object"===typeof c&&"idClass"in c&&d.each(a,function(a,b){"object"===typeof b&&"idClass"in b&&c.idClass==b.idClass&&h.push(b)})}),d.each(a,function(a,b){var c=!1;"object"===typeof b&&"idClass"in b&&d.each(h,
function(a,d){"object"===typeof d&&"idClass"in d&&d.idClass==b.idClass&&(c=!0)});c||h.push(b)})):h=a;"array"!==d.type(a)&&(h=[a]);f=h;e.html("");d.each(h,function(a,c){b(c)})}}})(jQuery);(function(d){vorple.cookie={};vorple.cookie.defaults={expires:365};vorple.cookie.read=function(a,c){var b,e=d.extend({},self.defaults,c).raw?function(a){return a}:decodeURIComponent;return(b=RegExp("(?:^|; )"+encodeURIComponent(a)+"=([^;]*)").exec(document.cookie))?e(b[1]):null};vorple.cookie.remove=function(a){this.write(a,null)};vorple.cookie.write=function(a,c,b){b=d.extend({},this.defaults,b);if(null===c||void 0===c)b.expires=-1;if("number"===typeof b.expires){var e=b.expires,f=b.expires=new Date;
f.setDate(f.getDate()+e)}c=""+c;return document.cookie=[encodeURIComponent(a),"=",b.raw?c:encodeURIComponent(c),b.expires?"; expires="+b.expires.toUTCString():"",b.path?"; path="+b.path:"",b.domain?"; domain="+b.domain:"",b.secure?"; secure":""].join("")}})(jQuery);(function(d){vorple.html={};vorple.html.defaults={allowedTagAttributes:"accesskey,abbr,align,alt,axis,border,cellpadding,cellspacing,char,charoff,class,colspan,dir,disabled,frame,headers,height,href,id,ismap,lang,longdesc,multiple,name,onblur,onclick,ondblclick,onfocus,onkeydown,onkeypress,onkeyup,onmousedown,onmouseout,onmouseover,onmouseup,rel,rev,rowspan,rules,scope,size,src,style,summary,tabindex,target,title,type,usemap,valign,value,width".split(","),endTag:"auto",quotemarks:'"'};vorple.html._createLink=
function(a){var c=d.extend({},{endTag:"always"},a.options);c.href=a.url;return this.tag("a",a.content,c)};vorple.html.$toHtml=function(a){return"undefined"===typeof a.jquery?"":a.first().clone().wrap("<div></div>").parent().html()};vorple.html.attributes=function(a){var c=this,b=d.extend({},c.defaults,a),e="";"undefined"!==typeof b.classes&&(e=' class="'+b.classes+'"');d.each(b,function(a,g){if(-1<d.inArray(a,b.allowedTagAttributes)||0===a.indexOf("data-"))e+=" "+a+'="'+c.escapeHtmlChars(g)+'"'});
b.escape&&(e=c.escapeHtmlChars(e));return e};vorple.html.escapeHtmlChars=function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};vorple.html.link=function(a,c,b){var e=this,b=d.extend({},{classes:""},e.defaults,b);if(d.isArray(a)){var f=vorple.core.generateId(),g=d(vorple.html.tag("ul",null,{endTag:"always",classes:"options linkPopup popup_"+f,style:"display:none; position:absolute;"}));d.each(a,function(a,b){d("<li>").append(d(e.link(b))).appendTo(g)});
d("body").on("click",".popuplink_"+f,function(a){a.preventDefault();a.stopPropagation();d(".linkPopup").hide();g.appendTo("body").show().offset({left:a.pageX,top:a.pageY})});d("body").on("click",".popup_"+f+" a",function(a){a.preventDefault();vorple.core.clickLink(d(this).attr("href"));d(".linkPopup").hide();return!1});b.classes+="popupLink popuplink_"+f;return vorple.html.link("#",c,b)}return"object"===typeof a?e._createLink(a):e._createLink({url:a,content:c,options:b})};d(document).bind("vorpleInit",
function(){d(document).on("click",function(){d(".linkPopup").hide()})});vorple.html.p=function(a,c){return vorple.html.tag("p",a,c)};vorple.html.quote=function(a,c){var b,d;"undefined"==typeof c&&(c=this.defaults.quotemarks);"string"==typeof c?d=b=c:(b=c[0],d=c[1]);return b+a+d};vorple.html.replaceAttributes=function(a,c){for(var b=a.get(0).attributes,e=0;e<b.length;++e)a.attr(b[e].name,"");d.each(c,function(b,c){"classes"==b?a.attr("class",c):a.attr(b,c)})};vorple.html.tag=function(a,c,b){var e=
d.extend({},this.defaults,b),b="<"+a+this.attributes(e);"always"==e.endTag||"auto"==e.endTag&&"string"===typeof c?("string"!==typeof c&&!c&&(c=""),a=">"+c+"</"+a+">"):a=c?">"+c:"auto"==e.endTag?" />":">";return b+a};vorple.html.url=function(a,c){return"undefined"==typeof a||!a?"undefined"==typeof c||!c?c:"#":"undefined"==typeof c||!c||a.match(/^[a-zA-Z]*:\/\//)||0===a.indexOf("/")||0===a.indexOf(".")?a:c+"/"+a}})(jQuery);(function(d){vorple.media={_muted:{music:!1,sound:!1}};vorple.media.defaults={type:"sound",audioPath:"media/audio",imagePath:"media/image",musicPath:"media/music",videoPath:"media/video",muted:!1,mainContainer:"vorple-media",musicContainer:"vorple-music",soundContainer:"vorple-sound",playerSolution:"html, flash",preload:"auto",swfPath:"lib",volume:0.8};vorple.media._createMainContainer=function(a,c){0==d("#"+a).length&&("undefined"===typeof c&&(c=d("body")),c.append(d('<div id="'+a+'"></div>')));
return d("#"+a)};vorple.media._createPlayer=function(a){a=d.extend({},this.defaults,a);if("string"==typeof a.element)return d("#"+a.element);if("object"===d.type(a.element)&&a.element.jquery)return a.element;a="object"===typeof a.parent&&a.parent.jquery?a.parent:"string"===typeof a.parent?this._createMainContainer(a.parent,d("#"+a.mainContainer)):"object"===typeof a.mainContainer&&a.mainContainer.jquery?a.mainContainer:d("#"+a.mainContainer);$element=d('<div id="jplayer_'+vorple.core.generateId()+
'" class="jp-jplayer"></div>');a.append($element);return $element};vorple.media.mute=function(a,c){var b=d.extend({},this.defaults,c);"undefined"!==typeof a.music&&(this._muted.music=a.music,d("#"+b.musicContainer).jPlayer(a.music?"mute":"unmute"),d('input.mute[value="music"]').attr("checked",a.music),d('input.unmute[value="music"]').attr("checked",!a.music),a.music?d('input.unmute[value="all"]').attr("checked",!1):d('input.mute[value="all"]').attr("checked",!1));"undefined"!==typeof a.sound&&(this._muted.sound=
a.sound,d("#"+b.soundContainer).children().jPlayer(a.sound?"mute":"unmute"),d('input.mute[value="sound"]').attr("checked",a.sound),d('input.unmute[value="sound"]').attr("checked",!a.sound));d('input.mute[value="all"]').attr("checked",this._muted.sound&&this._muted.music);d('input.unmute[value="all"]').attr("checked",!this._muted.sound&&!this._muted.music);vorple.cookie.write("vorpleMute",(this._muted.sound?"1":"0")+","+(this._muted.music?"1":"0"))};vorple.media.muteAll=function(a){"undefined"==typeof a&&
(a=!0);this.mute({music:a,sound:a});return a};vorple.media._play=function(a,c){var b=d.extend({},this.defaults,c),e;if(b.onReady)var f=b.onReady;e="undefined"==typeof b.container||!b.container?this._createPlayer(c):b.container;e.jPlayer("destroy");var g={},i=[];d.each(a,function(a,c){g[a]=vorple.html.url(c,b.audioPath);i.push(a)});e.jPlayer({muted:b.muted,preload:"auto",ready:function(){d(this).jPlayer("setMedia",g).jPlayer("play");d.isFunction(f)&&f()},solution:b.solution,supplied:i.join(", "),swfPath:b.swfPath,
volume:b.volume});return e};vorple.media.image=function(a,c){var b=this.defaults.imagePath;"object"===typeof c&&"undefined"!==typeof c.imagePath&&(b=c.imagePath);b=d.extend({},{src:vorple.html.url(a,b)},c);return vorple.html.tag("img",null,b)};vorple.media.isMuted=function(a){var c=this,b=a,e=[];"string"==typeof a&&(b=[a]);d.each(b,function(a,b){"all"===b?e.push(c._muted.sound&&c._muted.music):e.push(c._muted[b])});return"string"==typeof a?e[0]:e};vorple.media.playMusic=function(a,c){var b=d.extend({},
this.defaults,c);b.audioPath=this.defaults.musicPath;this._muted.music&&(b.muted=!0);$musicContainer=this._createMainContainer(b.musicContainer,d("#"+b.mainContainer));b.container=$musicContainer;return this._play(a,b)};vorple.media.playSound=function(a,c){if(!vorple.core.engine("undum")||undum.isInteractive()){var b=d.extend({},this.defaults,c);this._muted.sound&&(b.muted=!0);$container=this._createMainContainer(b.soundContainer,d("#"+b.mainContainer));b.mainContainer=$container;b=this._play(a,b);
b.bind(d.jPlayer.event.ended,function(){d(this).jPlayer("destroy")});return b}};vorple.media.preloadImage=function(a,c){var b=d.extend({},this.defaults,c);if("string"==typeof a){var e=new Image;e.src=vorple.html.url(a,b.imagePath);return e}if(d.isArray(a)){var f=[];d.each(a,function(){var a=new Image;a.src=vorple.html.url(this,b.imagePath);f.push(a)});return f}throw Error("Illegal file type given to the image preloader (only String and Array allowed)");};vorple.media.stopAll=function(){this.stopMusic();
this.stopSounds()};vorple.media.stopMusic=function(){d("#"+this.defaults.musicContainer).jPlayer("destroy")};vorple.media.stopSounds=function(){d("#"+this.defaults.soundContainer).children().jPlayer("destroy")};vorple.media.toggleMute=function(a){var c=this,b=a,e=[];"string"==typeof a&&(b=[a]);var f={};d.each(b,function(a,b){f[b]=!c._muted[b];e.push(!c._muted[b])});c.mute(f);return"string"==typeof a?e[0]:e};vorple.media.youtube=function(a,c){var b=d.extend({},this.defaults.youtube,c),e="http://www.youtube.com/v/"+
a+"?version=3",f=d.param(b.parameters);f&&(e+="&"+f);return'<object width="'+b.width+'" height="'+b.height+'"><param name="movie" value="'+e+'"></param><param name="allowScriptAccess" value="always"></param><embed src="'+e+'" type="application/x-shockwave-flash" allowscriptaccess="always" width="'+b.width+'" height="'+b.height+'"></embed></object>'};vorple.media.defaults.youtube={width:640,height:390,parameters:{autoplay:"1",controls:"0",disablekb:"1",modestbranding:"1",rel:"0"}};d(document).bind("vorpleInit",
function(){0==d("#"+vorple.media.defaults.mainContainer).length&&d("body").append(d('<div id="'+vorple.media.defaults.mainContainer+'"></div>'));var a=vorple.cookie.read("vorpleMute");a&&(a=a.split(","),vorple.media.mute({sound:"1"==a[0],music:"1"==a[1]}));d(document).delegate("input.mute","change",function(){var a=d(this);if("all"==a.val())vorple.media.muteAll(a.is(":checked"));else{var b={};b[a.val()]=a.is(":checked");vorple.media.mute(b)}});d(document).delegate("input.unmute","change",function(){var a=
d(this);if("all"==a.val())vorple.media.muteAll(!a.is(":checked"));else{var b={};b[a.val()]=!a.is(":checked");vorple.media.mute(b)}})})})(jQuery);(function(d){vorple.tabs={};vorple.tabs.create=function(a){var c=a;if("object"!=typeof a||!a.jquery)c=d(a);if(!d.tabs)throw Error("jQuery UI tabs is not installed");return c.tabs()}})(jQuery);(function(d){vorple.tooltip={};vorple.tooltip.defaults={show:{event:"mouseenter",ready:!1},content:{attr:"title"},position:{my:"bottom left",at:"top center"},overwrite:!1,delay:3E3,duration:1E4};vorple.tooltip._create=function(a,c){var b=d.extend({},this.defaults,c),e=d(a);!b.content&&e.attr(b.content.attr);b.content&&e.qtip(b);return e};vorple.tooltip.enable=function(a,c){var b=this,e=d.extend(!0,{},b.defaults,{show:{ready:!0,event:b.defaults.show.event}},c);return d(document).delegate(a,e.show.event,
function(){b._create(this,e)})};vorple.tooltip.show=function(a,c,b){"undefined"===typeof c&&(c=!0);var e=d.extend({},this.defaults,{show:{ready:!1,event:!1},hide:{event:!1},content:{text:c},events:{hide:function(a,b){b.destroy()}}},b),f=this._create(a,e);return setTimeout(function(){0<f.length&&(f.qtip("show"),setTimeout(function(){0<f.length&&f.qtip("hide")},e.duration))},e.delay)}})(jQuery);(function(d){vorple.undum={};vorple.undum.settings={allDisposable:!1,disposableLinks:[],disposableExceptions:[]};vorple.undum._afterTurnTasks=function(a,c,b,e){var f=this;f.settings.allDisposable?-1==d.inArray(e,f.settings.disposableExceptions)&&f.dispose(e):-1<d.inArray(e,f.settings.disposableLinks)&&f.dispose(e);d.each(undum.game._disposedLinks,function(a,b){f._removeDisposed(b)});f._enforceUnique()};vorple.undum._enforceUnique=function(){d("#content").find("a").each(function(a,c){var b=d(c),e=
b.attr("href"),f=!1;b.hasClass("unique")&&d('#content a[href="'+e+'"]').each(function(a,b){var c=d(b);c.hasClass("unique")&&!f?f=!0:c.replaceWith(d("<span>").html(c.html()))})})};vorple.undum._removeDisposed=function(a){d("a[href$='"+a+"'], a[href='"+a+"']").each(function(a,b){var e=d(b);e.replaceWith(d("<span>").addClass("ex_link").html(e.html()))})};vorple.undum.afterActionTrigger=function(a,c,b,d){this._afterTurnTasks(a,c,b,d);return!1};vorple.undum.afterEnterTrigger=function(a,c,b,d){this._afterTurnTasks(a,
c,b,d);return!1};vorple.undum.dispose=function(){var a=this;d.each(arguments,function(c,b){if(d.isArray(b))d.each(b,function(b,c){a.dispose(c)});else if(!a.isDisposed(b)){var e=b.split("/");undum.game._disposedLinks.push(e[e.length-1]);a._removeDisposed(b)}})};vorple.undum.isDisposed=function(a){return-1<d.inArray(a,undum.game._disposedLinks)};vorple.undum.reactivate=function(){var a=this;d.each(arguments,function(c,b){if(d.isArray(b))d.each(b,function(b,c){a.reactivate(c)});else{var e=b.split("/"),
e=d.inArray(e[e.length-1],undum.game._disposedLinks);-1<e&&undum.game._disposedLinks.splice(e,1)}})};d(document).bind("vorpleInit",function(){vorple.core.engine("undum")&&(undum.game.afterEnter||(undum.game.afterEnter=function(a,c,b,d){return vorple.undum.afterEnterTrigger(a,c,b,d)}),undum.game.afterAction||(undum.game.afterAction=function(a,c,b,d){return vorple.undum.afterActionTrigger(a,c,b,d)}),"undefined"===typeof undum.game._disposedLinks&&(undum.game._disposedLinks=[]))})})(jQuery);
